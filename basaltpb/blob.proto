syntax = "proto3";

package basaltpb;

option go_package = "github.com/cockroachdb/basaltclient/basaltpb";

import "basaltpb/common.proto";

// Blob handles control operations on a single blob server.
// Each blob server stores object replicas on local disks.
//
// Data operations (Append, Read) use a separate custom TCP protocol
// for lower overhead - see internal/blob/protocol.go for details.
service Blob {
  // Create initializes a new object on this blob server.
  rpc Create(BlobCreateRequest) returns (BlobCreateResponse);

  // Seal marks an object as immutable on this replica.
  rpc Seal(BlobSealRequest) returns (BlobSealResponse);

  // Delete removes an object from this blob server.
  rpc Delete(BlobDeleteRequest) returns (BlobDeleteResponse);

  // Stat returns metadata about an object.
  rpc Stat(BlobStatRequest) returns (BlobStatResponse);
}

message BlobCreateRequest {
  ObjectID id = 1;
}

message BlobCreateResponse {}

message BlobSealRequest {
  ObjectID id = 1;
}

message BlobSealResponse {
  // Final size of the sealed object.
  int64 final_size = 1;
}

message BlobDeleteRequest {
  ObjectID id = 1;
}

message BlobDeleteResponse {}

message BlobStatRequest {
  ObjectID id = 1;
}

message BlobStatResponse {
  // Current size of the object.
  int64 size = 1;
  // Whether the object is sealed.
  bool sealed = 2;
}
