syntax = "proto3";

package basaltpb;

option go_package = "github.com/cockroachdb/basaltclient/basaltpb";

import "gogoproto/gogo.proto";

option (gogoproto.goproto_getters_all) = false;
option (gogoproto.goproto_unrecognized_all) = false;
option (gogoproto.goproto_sizecache_all) = false;
option (gogoproto.goproto_unkeyed_all) = false;

// ObjectMeta contains metadata about an object.
message ObjectMeta {
  // Unique identifier for this object.
  bytes id = 1 [(gogoproto.customtype) = "UUID", (gogoproto.nullable) = false];
  // Current size of the object in bytes. -1 for directories, 0 for unsealed files.
  int64 size = 2;
  // List of replicas storing this object.
  repeated ReplicaInfo replicas = 3 [(gogoproto.nullable) = false];
  // Reference to archive location (e.g., S3/GCS path) if archived.
  string archive_ref = 4;
  // Replication policy for the object (NULL for directories).
  ReplicationPolicy policy = 5;
  // Creation timestamp in unix nanoseconds.
  int64 created_at_nanos = 6;
  // Seal timestamp in unix nanoseconds (0 if unsealed).
  int64 sealed_at_nanos = 7;
}

// ReplicaInfo describes a replica of an object stored on a blob server.
message ReplicaInfo {
  // Addr of the blob server holding this replica (host:port).
  string addr = 1;
  // Zone of the blob server.
  string zone = 2;
}

// EntryType distinguishes files from directories in the namespace.
enum EntryType {
  ENTRY_TYPE_UNSPECIFIED = 0;
  ENTRY_TYPE_FILE = 1;
  ENTRY_TYPE_DIRECTORY = 2;
}

// DirectoryEntry represents an entry in a directory listing.
message DirectoryEntry {
  // Name of the entry within its parent directory.
  string name = 1;
  // Type of entry (file or directory).
  EntryType type = 2;
  // ID of the target: object_id for files, directory_id for directories.
  bytes id = 3 [(gogoproto.customtype) = "UUID", (gogoproto.nullable) = false];
  // Size in bytes (only set for sealed files).
  int64 size = 4;
  // Creation timestamp in unix nanoseconds.
  int64 created_at_nanos = 5;
  // Seal timestamp in unix nanoseconds (0 if unsealed).
  int64 sealed_at_nanos = 6;
  // List of replicas storing this object (only set for files).
  repeated ReplicaInfo replicas = 7 [(gogoproto.nullable) = false];
}

// Reference represents a namespace reference (hardlink) to an object.
message Reference {
  // Directory containing this reference.
  bytes directory_id = 1 [(gogoproto.customtype) = "UUID", (gogoproto.nullable) = false];
  // Name of the entry within the directory.
  string name = 2;
}

// ReplicationPolicy specifies the target/requested replication configuration for an object.
// This represents the desired state; actual replica placement may differ temporarily.
message ReplicationPolicy {
  // Target number of SSD blob replicas. Default is 3 if no parameters specified.
  int32 ssd_replicas = 1;
  // Target number of HDD blob replicas. Default is 0.
  int32 hdd_replicas = 2;
  // Whether to archive to cloud object storage (S3/GCS).
  bool archive = 3;
  // If set, all replicas placed in this zone; if empty, cross-zone placement.
  string local_zone = 4;
}
